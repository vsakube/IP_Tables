Sequence of processing in iptables
----------------------------------

In iptables, when a packet arrives at the system, it goes through a sequence of tables and chains to determine how it should be handled. The sequence of processing is as follows:


1. Prerouting (raw table): In this step, the packet is first processed by the raw table's PREROUTING chain. This table is used to set up exemptions from connection tracking and is often used for performance optimizations.

2. Prerouting (mangle table): After the raw table's PREROUTING chain, the packet is processed by the mangle table's PREROUTING chain. The mangle table is used for specialized packet modifications, such as altering packet headers, TOS (Type of Service) settings, and packet marking.

3. Prerouting (nat table): Next, the packet is processed by the nat table's PREROUTING chain. This is where Network Address Translation (NAT) rules are applied, which allows rewriting source or destination addresses of packets before routing.

4. Routing Decision: After the prerouting chains, the Linux kernel makes the routing decision, determining which network interface the packet should be forwarded to or if it should be delivered to a local process on the system.

5. Input (filter table): If the packet is destined for the local system, it is processed by the filter table's INPUT chain. This chain is responsible for filtering incoming packets destined for the local machine.

6. Forward (filter table): If the packet is to be forwarded through the system, it is processed by the filter table's FORWARD chain. This chain is responsible for filtering packets that are being routed through the system.

7. Output (raw table): If the packet is locally generated by a process on the system, it is processed by the raw table's OUTPUT chain. The raw table is used for exemptions from connection tracking and other raw packet handling.

8. Output (mangle table): After the raw table's OUTPUT chain, the packet is processed by the mangle table's OUTPUT chain. Similar to the prerouting mangle chain, this chain allows for specialized packet modifications.

9. Output (nat table): The packet is then processed by the nat table's OUTPUT chain. This is where NAT rules are applied to locally generated packets before they leave the system.

10. Postrouting (nat table): Finally, the packet is processed by the nat table's POSTROUTING chain. This is where NAT rules are applied to packets after they have been routed. The POSTROUTING chain is used to rewrite source addresses for outgoing packets.

If a packet matches a rule in any chain, the corresponding action defined in the rule is executed (e.g., ACCEPT, DROP, REJECT, etc.), and no further processing within that table occurs for that packet. If a packet doesn't match any rule in a chain, 
it moves on to the next chain in the same table. If the packet doesn't match any rule in all the chains of a table, it moves on to the next table in the sequence.
